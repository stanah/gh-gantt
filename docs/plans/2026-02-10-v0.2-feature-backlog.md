# gh-gantt v0.2 Feature Backlog

> **作成日**: 2026-02-10
> **目的**: v0.2以降で実装予定の機能一覧。最終的にtasks.jsonに変換し、push機能でGitHub Issueとして登録する。

---

## 1. Pushによるissue登録機能

**概要**: ローカルで作成したタスク（`github_issue: null`）を`gh gantt push --create-issues`でGitHub Issueとして新規作成する。

**要件**:
- tasks.jsonにあるがGitHub Issueが紐づいていないタスクを検出
- push時にIssue作成 → issue番号・node_idをsync-state.jsonに記録
- タイトル、body、labels、milestone、assigneesを反映
- ProjectV2アイテムとしても追加
- Sub Issues APIで親子関係も設定
- dry-runモードで作成予定のIssue一覧をプレビュー

**影響範囲**:
- `packages/cli/src/commands/push.ts`
- `packages/cli/src/github/issues.ts`
- `packages/cli/src/github/mutations.ts`
- `packages/cli/src/sync/mapper.ts`
- `packages/cli/src/store/state.ts`

---

## 2. 複数階層のツリー表示

**概要**: 現在のツリー表示を拡張し、epic > feature > task > sub-taskのような多段階層を正しく表示・操作できるようにする。

**要件**:
- N段階層のインデント表示
- 各階層での折りたたみ/展開（独立制御）
- 階層の深さに応じたインデントガイドライン表示
- summaryバーのネスト表示（親summaryが子summaryを包含）
- type_hierarchyバリデーションの厳格化

**影響範囲**:
- `packages/ui/src/components/TaskTree.tsx`
- `packages/ui/src/components/TaskRow.tsx`
- `packages/ui/src/hooks/useTaskTree.ts`
- `packages/ui/src/components/GanttSummaryBar.tsx`

---

## 3. ツリー表示でのドラッグ&ドロップによる依存関係付け替え

**概要**: ツリー上でタスクをドラッグ&ドロップすることで、親子関係（parent/sub_tasks）やブロック関係（blocked_by）を直感的に付け替える。

**要件**:
- タスク行をドラッグして別タスクの子としてドロップ → parent/sub_tasks更新
- ドロップ位置のハイライト表示（挿入ポイントインジケータ）
- type_hierarchyルールに違反するドロップは拒否（視覚的フィードバック）
- Alt+ドラッグでblocked_by関係の追加（別モード）
- Undo対応（将来）

**影響範囲**:
- `packages/ui/src/components/TaskTree.tsx`
- `packages/ui/src/components/TaskRow.tsx`
- `packages/ui/src/hooks/useDragResize.ts`（拡張 or 新規hook）
- `packages/shared/src/types.ts`

---

## 4. 検索機能（fuzzy検索）

**概要**: タスクのタイトル・body・ラベル等を対象としたfuzzy検索を提供し、大量タスク内から目的のタスクを素早く見つけられるようにする。

**要件**:
- Ctrl+K / Cmd+K でコマンドパレット風の検索UIを開く
- タイトル、body、labels、assignees、issue番号を検索対象
- fuzzy matching（部分一致・typo許容）
- 検索結果からタスクを選択 → ツリーで該当タスクをハイライト＆スクロール
- ガント側も該当タスクにスクロール＆ハイライト
- 検索結果の即時プレビュー（タイトル、type、status表示）

**技術候補**: fuse.js（MIT）

**影響範囲**:
- `packages/ui/src/components/SearchPalette.tsx`（新規）
- `packages/ui/src/hooks/useSearch.ts`（新規）
- `packages/ui/src/components/Toolbar.tsx`
- `packages/ui/src/App.tsx`

---

## 5. カスタムフィールドによるType管理 / issueのMilestone連携

**概要**: 現在のラベルベースのType・Milestone管理から、GitHub ProjectV2のカスタムフィールドによるType管理、およびissue本体のmilestoneフィールドとの連携に変更する。

**要件**:
- TypeをProjectV2のSingle Selectカスタムフィールドから取得
- gantt.config.jsonの`task_types`設定にカスタムフィールド名を指定可能に
- MilestoneはGitHub issueのmilestoneフィールドを使用（ラベルではなく）
- 既存のラベルベース判別はフォールバックとして残す（互換性）
- init時にカスタムフィールドの選択肢を自動取得

**影響範囲**:
- `packages/cli/src/sync/type-resolver.ts`
- `packages/cli/src/github/projects.ts`
- `packages/cli/src/commands/init.ts`
- `packages/shared/src/types.ts`
- `packages/shared/src/schema.ts`
- `packages/cli/src/store/config.ts`

---

## 6. Markdown表示対応

**概要**: タスクのbodyフィールド（Markdown）をリッチに表示する。TaskDetailPanelのプレビューおよびホバーツールチップでの表示。

**要件**:
- TaskDetailPanelでMarkdownのレンダリング表示
- 編集モードとプレビューモードの切り替え（タブ or トグル）
- GFM（GitHub Flavored Markdown）対応: テーブル、チェックリスト、コードブロック
- 画像URL表示対応
- ツリーのタスク行ホバー時にbody先頭をツールチップ表示

**技術候補**: react-markdown + remark-gfm（MIT）

**影響範囲**:
- `packages/ui/src/components/MarkdownEditor.tsx`（拡張）
- `packages/ui/src/components/TaskDetailPanel.tsx`
- `packages/ui/src/components/TaskRow.tsx`（ツールチップ追加）

---

## 7. Assigneeフィルタ

**概要**: 特定のassignee（担当者）でタスクをフィルタリングし、自分の担当タスクだけを表示できるようにする。

**要件**:
- ツールバーにassigneeフィルタドロップダウンを追加
- 複数assignee同時選択可
- "未アサイン"フィルタ
- フィルタ適用時、summaryタスクは該当子タスクがある場合のみ表示
- assignee一覧はtasks.jsonから自動収集
- URLパラメータでフィルタ状態を保持

**影響範囲**:
- `packages/ui/src/components/Toolbar.tsx`
- `packages/ui/src/components/AssigneeFilter.tsx`（新規）
- `packages/ui/src/hooks/useAssigneeFilter.ts`（新規）
- `packages/ui/src/hooks/useTaskTree.ts`（フィルタ適用ロジック）

---

## 8. マイルストーンのラベル表示改善

**概要**: ガントチャート上で期間が短いタスクやマイルストーンのラベル（タイトル）が小さすぎて読めない問題を解決する。

**要件**:
- バー幅がタイトル表示に不十分な場合、バー右側にラベルをオーバーフロー表示
- マイルストーン（◆）の横にタイトルを常時表示
- ズームレベルに応じたラベル表示/非表示の閾値設定
- ラベル同士の重なり検出と自動オフセット
- ホバー時にフルタイトルをツールチップ表示

**影響範囲**:
- `packages/ui/src/components/GanttBar.tsx`
- `packages/ui/src/components/GanttMilestone.tsx`
- `packages/ui/src/components/GanttSummaryBar.tsx`
- `packages/ui/src/hooks/useGanttScale.ts`（閾値計算）

---

## 9. ガント上にissue番号・assignee表示

**概要**: ガントチャートのバー上またはバー付近にissue番号（#42）とassigneeアバター/名前を表示し、一目で識別できるようにする。

**要件**:
- バー上にissue番号（`#42`）を表示
- バー上またはバー末尾にassigneeアイコン（GitHubアバター or イニシャル）を表示
- バー幅が狭い場合はissue番号のみ表示（レスポンシブ）
- 表示項目のON/OFFトグル（ツールバー）
- assigneeアバター画像のキャッシュ

**影響範囲**:
- `packages/ui/src/components/GanttBar.tsx`
- `packages/ui/src/components/GanttSummaryBar.tsx`
- `packages/ui/src/components/Toolbar.tsx`
- `packages/ui/src/hooks/useGanttScale.ts`

---

## 10. Sprint設定・ガント上へのスプリント期間表示

**概要**: スプリント（イテレーション）を定義し、ガントタイムライン上にスプリント期間を視覚的に表示する。

**要件**:
- gantt.config.jsonにsprint設定を追加（期間、名前、色）
- ProjectV2のIterationフィールドと連携（自動取得）
- ガントタイムラインのヘッダー上部にスプリント期間帯を表示
- スプリント境界の縦線表示
- スプリント名のラベル表示
- 現在スプリントのハイライト
- スプリント別のタスク集計（将来）

**影響範囲**:
- `packages/shared/src/types.ts`（Sprint型追加）
- `packages/shared/src/schema.ts`（zodスキーマ追加）
- `packages/cli/src/store/config.ts`
- `packages/cli/src/github/projects.ts`（Iterationフィールド取得）
- `packages/ui/src/components/GanttTimeline.tsx`
- `packages/ui/src/components/GanttGrid.tsx`（スプリント境界線）
- `packages/ui/src/components/SprintHeader.tsx`（新規）

---

## 11. キーボードショートカット

**概要**: マウスに頼らず高速にタスク操作・ナビゲーションできるキーボードショートカットを提供する。

**要件**:
- j/k でツリー内のタスク移動（フォーカス上下）
- Enter でタスク編集開始、Esc でキャンセル
- Space で折りたたみ/展開トグル
- Ctrl+N / Cmd+N で新規タスク作成
- Ctrl+K / Cmd+K で検索パレットを開く（#4と連動）
- Ctrl+Z / Ctrl+Shift+Z でUndo/Redo（#12と連動）
- Tab / Shift+Tab で階層インデント変更
- Delete / Backspace でタスク削除（確認ダイアログ）
- ショートカット一覧のヘルプパネル（? キー）
- gantt.config.json or ローカル設定でキーバインドのカスタマイズ

**影響範囲**:
- `packages/ui/src/hooks/useKeyboardShortcuts.ts`（新規）
- `packages/ui/src/components/ShortcutHelpPanel.tsx`（新規）
- `packages/ui/src/components/TaskTree.tsx`（フォーカス管理）
- `packages/ui/src/App.tsx`（グローバルキーハンドラ）

---

## 12. Undo/Redo

**概要**: UIでの全編集操作に対してUndo/Redoを提供し、誤操作からの復帰を可能にする。

**要件**:
- Ctrl+Z / Cmd+Z でUndo、Ctrl+Shift+Z / Cmd+Shift+Z でRedo
- 操作履歴スタック（tasks.jsonの差分ベース）
- バードラッグ、ステータス変更、タイトル編集、親子関係変更等すべての編集を対象
- 履歴の上限設定（メモリ制約）
- push後は履歴をクリア（同期済みの変更は巻き戻し対象外）
- ツールバーにUndo/Redoボタン表示（残り回数表示）

**影響範囲**:
- `packages/ui/src/hooks/useUndoRedo.ts`（新規）
- `packages/ui/src/hooks/useApi.ts`（操作記録のラップ）
- `packages/ui/src/components/Toolbar.tsx`
- `packages/cli/src/server/api.ts`（操作履歴エンドポイント）

---

## 13. クリティカルパス表示

**概要**: CPM（Critical Path Method）でプロジェクトの最長経路を計算し、ガントチャート上で赤色ハイライトする。遅延が全体に影響するタスクを可視化。

**要件**:
- blocked_byの依存関係グラフからforward/backward passで最長経路を算出
- クリティカルパス上のタスクバーを赤色（またはcritical_path色）でハイライト
- ツールバーにクリティカルパス表示ON/OFFトグル
- クリティカルパス上のblocked_by矢印も強調表示
- 各タスクのフロート（余裕日数）をツールチップに表示
- 循環依存がある場合はエラー表示

**影響範囲**:
- `packages/ui/src/lib/critical-path.ts`（新規）
- `packages/ui/src/lib/dependency-graph.ts`（拡張）
- `packages/ui/src/components/GanttBar.tsx`
- `packages/ui/src/components/GanttBlockLines.tsx`
- `packages/ui/src/components/Toolbar.tsx`

---

## 14. 遅延タスクの自動ハイライト

**概要**: end_dateを過ぎてもclosedになっていないタスクを自動検出し、ガントチャート上で警告表示する。

**要件**:
- 今日 > end_date かつ state != closed のタスクを「遅延」と判定
- 遅延タスクのバーをoverdue色（赤）で表示、または斜線パターン
- 遅延日数の表示（バー右端に「+3d」等）
- ツリー側にも遅延アイコン/バッジ表示
- serve起動時に遅延タスクのサマリーを通知表示
- 期限N日前のタスクを「at_risk」（黄色）で表示する閾値設定

**影響範囲**:
- `packages/ui/src/lib/date-utils.ts`（遅延判定ロジック）
- `packages/ui/src/components/GanttBar.tsx`
- `packages/ui/src/components/TaskRow.tsx`（遅延バッジ）
- `packages/ui/src/components/Toolbar.tsx`（遅延フィルタ）
- `packages/shared/src/types.ts`（gantt.colors設定の活用）

---

## 15. SVG/PNGエクスポート

**概要**: 現在のガントビューを画像ファイルとして出力する。報告資料やSlack共有用。

**要件**:
- ツールバーのエクスポートボタンから実行
- SVG形式（ベクター、編集可能）とPNG形式（ラスター、共有向け）を選択
- エクスポート範囲: 表示中のビュー or プロジェクト全体
- ツリーペイン + ガントペインの両方を含む
- 高解像度（2x）オプション
- ファイル名に日付を自動付与（例: `gh-gantt-2026-02-10.png`）
- CLIからも実行可能: `gh gantt export --format png`

**影響範囲**:
- `packages/ui/src/lib/export.ts`（新規）
- `packages/ui/src/components/ExportDialog.tsx`（新規）
- `packages/ui/src/components/Toolbar.tsx`
- `packages/cli/src/commands/export.ts`（新規）

---

## 16. Webhook/ポーリングによる自動同期

**概要**: serve中にGitHub側の変更を自動検知し、手動pullなしでローカルデータを最新化する。

**要件**:
- ポーリングモード: 一定間隔（設定可、デフォルト60秒）でGitHub APIに差分問い合わせ
- updated_atベースの差分検出で無駄なAPI呼び出しを抑制
- 変更検知時にUI上にトースト通知（「3件のリモート変更を検出」）
- 自動適用 or 手動適用の選択（config設定）
- コンフリクト時は自動適用を停止して警告
- APIレートリミットを考慮したインターバル自動調整
- gantt.config.jsonに`sync.auto_poll_interval`設定を追加

**影響範囲**:
- `packages/cli/src/server/api.ts`（ポーリングエンドポイント）
- `packages/cli/src/sync/poll.ts`（新規）
- `packages/ui/src/hooks/useAutoSync.ts`（新規）
- `packages/ui/src/components/SyncNotification.tsx`（新規）
- `packages/shared/src/types.ts`（config拡張）

---

## 17. 自動スケジューリング

**概要**: blocked_byの依存関係に基づき、タスクの日程を自動で前詰め/後詰め計算する。手動で日付を一つずつ設定する手間を解消。

**要件**:
- forward pass: 依存元の終了日 + lag → 依存先の開始日を自動算出
- backward pass: 締切日から逆算して最遅開始日を算出
- 稼働日カレンダー（working_days + 祝日）を考慮した日程計算
- 自動スケジュール実行ボタン（ツールバー）
- 手動で設定した日付を固定（ピン留め）するオプション
- 計算結果のプレビュー → 適用/キャンセル選択
- 循環依存の検出と警告

**影響範囲**:
- `packages/ui/src/lib/auto-schedule.ts`（新規）
- `packages/ui/src/lib/dependency-graph.ts`（拡張）
- `packages/ui/src/lib/date-utils.ts`（稼働日計算の拡張）
- `packages/ui/src/components/Toolbar.tsx`
- `packages/ui/src/components/SchedulePreviewDialog.tsx`（新規）

---

## 18. 稼働カレンダー（祝日対応）

**概要**: working_days（曜日ベース）に加え、祝日・休暇日を個別に設定できるようにする。日程計算やガント表示に反映。

**要件**:
- gantt.config.jsonに`holidays`設定を追加（日付リスト + 名前）
- 国別祝日プリセット（日本、US等）のインポート機能
- カスタム休暇日の追加（会社固有の休日）
- ガントグリッド上で祝日を非稼働日と同様にグレーアウト
- 祝日にホバーで名前をツールチップ表示
- 日程計算（自動スケジューリング・バードラッグ）で祝日を除外
- UI上のカレンダー設定パネル

**影響範囲**:
- `packages/shared/src/types.ts`（Holiday型追加）
- `packages/shared/src/schema.ts`（zodスキーマ追加）
- `packages/ui/src/lib/date-utils.ts`（祝日考慮の稼働日計算）
- `packages/ui/src/components/GanttGrid.tsx`（祝日グレーアウト）
- `packages/ui/src/components/CalendarSettingsPanel.tsx`（新規）
- `packages/cli/src/store/config.ts`

---

## 実装優先度（案）

| 優先度 | 機能 | 理由 |
|--------|------|------|
| **P0** | 1. Push issue登録 | 基本的なワークフローの完成に必須 |
| **P0** | 5. カスタムフィールドType/Milestone | データモデルの根幹に関わる変更 |
| **P1** | 2. 複数階層ツリー | UI体験の基盤 |
| **P1** | 8. マイルストーンラベル表示 | 視認性の基本的な問題 |
| **P1** | 9. ガント上のissue#/assignee表示 | 視認性の基本的な問題 |
| **P1** | 12. Undo/Redo | 編集操作がある以上、誤操作復帰は必須 |
| **P1** | 14. 遅延タスク警告 | 管理ツールの基本機能 |
| **P2** | 6. Markdown表示 | body活用に必要 |
| **P2** | 7. Assigneeフィルタ | チーム利用で必須 |
| **P2** | 10. Sprint表示 | アジャイルチームでの利用 |
| **P2** | 11. キーボードショートカット | パワーユーザーの生産性に直結 |
| **P2** | 13. クリティカルパス | ガントチャートの核心機能 |
| **P2** | 15. SVG/PNGエクスポート | 報告・共有で必ず必要 |
| **P2** | 18. 稼働カレンダー（祝日） | working_daysがあるなら当然必要 |
| **P3** | 3. D&D依存関係付け替え | UX向上だが複雑度高 |
| **P3** | 4. Fuzzy検索 | 大規模プロジェクトで有用 |
| **P3** | 16. 自動同期 | 手動pull運用で当面は回る |
| **P3** | 17. 自動スケジューリング | 依存関係の活用度を上げる |

---

## 次のステップ

1. この仕様をtasks.jsonフォーマットに変換
2. `gh gantt push --create-issues`でGitHub Issue登録
   - ただし機能1自体が未実装のため、初回は手動 or CLIスクリプトで登録
